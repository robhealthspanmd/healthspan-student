@model healthspanmd.web.Models.Metric.MetricListViewModel
@{
	ViewData["Title"] = "Metrics";
	ViewData["LeftNav_ActiveItem"] = "Metrics";
}
<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
	
	<div id="kt_content_container" class="container-xxl">
		
		<div id="metricListContainer">
			<partial name="_AdminMetricList" model=Model />
		</div>

		@*<div class="modal fade" id="kt_modal_add_metric" tabindex="-1" aria-hidden="true">
			<!--begin::Modal dialog-->
			<div class="modal-dialog modal-dialog-centered mw-650px">
				<!--begin::Modal content-->
				<div class="modal-content">
					<!--begin::Form-->
					<form class="form" action="#" id="kt_modal_add_metric_form" data-kt-redirect="../dist/apps/customers/list.html">
						<input type="hidden" id="metricId" value="0" />
						<!--begin::Modal header-->
						<div class="modal-header" id="kt_modal_add_metric_header">
							<!--begin::Modal title-->
							<h2>Add a Metric</h2>
							<!--end::Modal title-->
							<!--begin::Close-->
							<div class="btn btn-icon btn-sm btn-active-icon-primary" onclick="$('#kt_modal_add_metric').modal('hide');">
								<!--begin::Svg Icon | path: icons/duotune/arrows/arr061.svg-->
								<span class="svg-icon svg-icon-1">
									<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
										<rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="black" />
										<rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="black" />
									</svg>
								</span>
								<!--end::Svg Icon-->
							</div>
							<!--end::Close-->
						</div>
						<!--end::Modal header-->
						<!--begin::Modal body-->
						<div class="modal-body py-10 px-lg-17">
							<!--begin::Scroll-->
							<div class="scroll-y me-n7 pe-7" id="kt_modal_add_metric_scroll" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-max-height="auto" data-kt-scroll-dependencies="#kt_modal_add_customer_header" data-kt-scroll-wrappers="#kt_modal_add_customer_scroll" data-kt-scroll-offset="300px">
								<div class="fv-row mb-7">
									<label class="required fs-6 fw-bold mb-2">Name</label>
									<input id="metricName" type="text" class="form-control form-control-solid" placeholder="" name="metricName" value="" />
								</div>
								<div class="fv-row mb-7">
									<label class="required fs-6 fw-bold mb-2">Description</label>
									<input id="metricDescription" type="text" class="form-control form-control-solid" placeholder="" name="metricDescription" />
								</div>
								<div class="d-flex flex-column mb-7 fv-row">
									<label class="fs-6 fw-bold mb-2">
										<span class="required">Data Type</span>
									</label>
									<select id="metricDataType" name="metricDataType" aria-label="Select a Data Type" data-control="select2" data-placeholder="Select a Data Type..." data-dropdown-parent="#kt_modal_add_metric" class="form-select form-select-solid fw-bolder">
										<option value="-1" disabled selected>Select a Data Type</option>
										<option value="0">Yes / No</option>
										<option value="1">Numeric (Integer)</option>
										<option value="2">Numeric (Decimal)</option>
										<option value="3">Alpha</option>
										<option value="4">Alpha Selection</option>
										<option value="5">Date</option>
									</select>
								</div>


								<!--  USE DATATABLES - API, Add Rows feature ??? -->

								<div class="fv-row mb-7">
									<label class="fs-6 fw-bold mb-2">Alpha Selection Options</label>
									

									<div class="g-10 draggable-zone" tabindex="0">




										<div class="draggable" tabindex="0">
											<!--begin::Card-->
											<div class="card card-bordered">
												<div class="card-header">
													<div class="card-title">
														<h3 class="card-label">Card 1</h3>
													</div>
													<div class="card-toolbar">
														<a href="#" class="btn btn-icon btn-sm btn-hover-light-primary draggable-handle">
															<!--begin::Svg Icon | path: icons/duotune/abstract/abs015.svg-->
															<span class="svg-icon svg-icon-2x">
																<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
																	<path d="M21 7H3C2.4 7 2 6.6 2 6V4C2 3.4 2.4 3 3 3H21C21.6 3 22 3.4 22 4V6C22 6.6 21.6 7 21 7Z" fill="black"></path>
																	<path opacity="0.3" d="M21 14H3C2.4 14 2 13.6 2 13V11C2 10.4 2.4 10 3 10H21C21.6 10 22 10.4 22 11V13C22 13.6 21.6 14 21 14ZM22 20V18C22 17.4 21.6 17 21 17H3C2.4 17 2 17.4 2 18V20C2 20.6 2.4 21 3 21H21C21.6 21 22 20.6 22 20Z" fill="black"></path>
																</svg>
															</span>
															<!--end::Svg Icon-->
														</a>
													</div>
												</div>
												<div class="card-body">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled. Lorem Ipsum is simply dummy text of the printing and typesetting industry.</div>
											</div>
											<!--end::Card-->
										</div>
										<div class=" draggable" tabindex="0">
											<!--begin::Card-->
											<div class="card card-bordered">
												<div class="card-header">
													<div class="card-title">
														<h3 class="card-label">Card 2</h3>
													</div>
													<div class="card-toolbar">
														<a href="#" class="btn btn-icon btn-hover-light-primary draggable-handle">
															<!--begin::Svg Icon | path: icons/duotune/abstract/abs015.svg-->
															<span class="svg-icon svg-icon-2x">
																<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
																	<path d="M21 7H3C2.4 7 2 6.6 2 6V4C2 3.4 2.4 3 3 3H21C21.6 3 22 3.4 22 4V6C22 6.6 21.6 7 21 7Z" fill="black"></path>
																	<path opacity="0.3" d="M21 14H3C2.4 14 2 13.6 2 13V11C2 10.4 2.4 10 3 10H21C21.6 10 22 10.4 22 11V13C22 13.6 21.6 14 21 14ZM22 20V18C22 17.4 21.6 17 21 17H3C2.4 17 2 17.4 2 18V20C2 20.6 2.4 21 3 21H21C21.6 21 22 20.6 22 20Z" fill="black"></path>
																</svg>
															</span>
															<!--end::Svg Icon-->
														</a>
													</div>
												</div>
												<div class="card-body">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled. Lorem Ipsum is simply dummy text of the printing and typesetting industry.</div>
											</div>
											<!--end::Card-->
										</div>
										<div class=" draggable" tabindex="0">
											<!--begin::Card-->
											<div class="card card-bordered">
												<div class="card-header">
													<div class="card-title">
														<h3 class="card-label">Card 3</h3>
													</div>
													<div class="card-toolbar">
														<a href="#" class="btn btn-icon btn-hover-light-primary draggable-handle">
															<!--begin::Svg Icon | path: icons/duotune/abstract/abs015.svg-->
															<span class="svg-icon svg-icon-2x">
																<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
																	<path d="M21 7H3C2.4 7 2 6.6 2 6V4C2 3.4 2.4 3 3 3H21C21.6 3 22 3.4 22 4V6C22 6.6 21.6 7 21 7Z" fill="black"></path>
																	<path opacity="0.3" d="M21 14H3C2.4 14 2 13.6 2 13V11C2 10.4 2.4 10 3 10H21C21.6 10 22 10.4 22 11V13C22 13.6 21.6 14 21 14ZM22 20V18C22 17.4 21.6 17 21 17H3C2.4 17 2 17.4 2 18V20C2 20.6 2.4 21 3 21H21C21.6 21 22 20.6 22 20Z" fill="black"></path>
																</svg>
															</span>
															<!--end::Svg Icon-->
														</a>
													</div>
												</div>
												<div class="card-body">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled. Lorem Ipsum is simply dummy text of the printing and typesetting industry.</div>
											</div>
											<!--end::Card-->
										</div>
										
									</div>
									

									<input type="text" class="form-control form-control-solid" placeholder="" name="description" />
								</div>
								<div class="row">
									<div class="fv-row mb-7 col-md-6">
										<label class="fs-6 fw-bold mb-2">Minimum Value</label>
										<input id="metricMinValue" type="number" class="form-control form-control-solid" placeholder="" name="metricMinValue" />
									</div>
									<div class="fv-row mb-7 col-md-6">
										<label class="fs-6 fw-bold mb-2">Maximum Value</label>
										<input id="metricMaxValue" type="number" class="form-control form-control-solid" placeholder="" name="metricMaxValue" />
									</div>
								</div>
								

								

								<div class="d-flex flex-stack">
									<!--begin::Label-->
									<div class="me-5">
										<label class="fs-6 fw-bold form-label">Allow Multiple Values?</label>
										<div class="fs-7 fw-bold text-gray-400">Indicate if multiple values are allowed for single entry</div>
									</div>
									<!--end::Label-->
									<!--begin::Switch-->
									<label class="form-check form-switch form-check-custom form-check-solid">
										<input id="metricAllowMultiple" class="form-check-input" type="checkbox" value="1"  />
										<span class="form-check-label fw-bold text-gray-400">Allow</span>
									</label>
									<!--end::Switch-->
								</div>

								
							</div>
							<!--end::Scroll-->
						</div>
						<!--end::Modal body-->
						<!--begin::Modal footer-->
						<div class="modal-footer flex-center">
							<!--begin::Button-->
							<button type="button" class="btn btn-light me-3" onclick="$('#kt_modal_add_metric').modal('hide');">Cancel</button>
							<!--end::Button-->
							<!--begin::Button-->
							<button type="button" id="kt_modal_add_customer_submit" class="btn btn-primary" onclick="updateMetric();">
								<span id="updateMetricButtonLabel" class="indicator-label">Submit</span>
								<span id="updateMetricButtonBusyLabel" class="indicator-progress">Please wait...
								<span id="updateMetricButtonBusySpinner" class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
							</button>
							<!--end::Button-->
						</div>
						<!--end::Modal footer-->
					</form>
					<!--end::Form-->
				</div>
			</div>
		</div>*@
	</div>
</div>

<div class="modal fade" tabindex="-1" id="modalConfirmDeactivate">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Deactivate Metric?</h5>

                <!--begin::Close-->
                <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" aria-label="Close">
                    <span class="svg-icon svg-icon-2x">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
							<rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="black"></rect>
							<rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="black"></rect>
						</svg>
					</span>
                </div>
                <!--end::Close-->
            </div>

            <div class="modal-body">
                <p>Are you sure you want to deactivate this metric?</p>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="deactivateMetric();">Deactivate</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" tabindex="-1" id="modalConfirmDelete">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Metric?</h5>

                <!--begin::Close-->
                <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal" aria-label="Close">
                    <span class="svg-icon svg-icon-2x">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
							<rect opacity="0.5" x="6" y="17.3137" width="16" height="2" rx="1" transform="rotate(-45 6 17.3137)" fill="black"></rect>
							<rect x="7.41422" y="6" width="16" height="2" rx="1" transform="rotate(45 7.41422 6)" fill="black"></rect>
						</svg>
					</span>
                </div>
                <!--end::Close-->
            </div>

            <div class="modal-body">
                <p>Are you sure you want to delete this metric?</p>
				<div class="alert-danger">
					Deleting a metric will result in all corresponding tracking data for this metric being lost.
				</div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="deleteMetric();">Delete Metric</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
	<script src="/assets/plugins/custom/datatables/datatables.bundle.js"></script>
	<script src="/assets/js/custom/apps/customers/list/list.js"></script>
	@*<script src="/assets/js/custom/apps/customers/add.js"></script>*@
	<script src="/assets/plugins/custom/draggable/draggable.bundle.js"></script>

	<script type="text/javascript">

		$(document).ready(function () {
			var handleSearchDatatable = function () {
                const filterSearch = document.querySelector('[data-kt-metrics-table-filter="search"]');
                filterSearch.addEventListener('keyup', function (e) {

					// Declare variables 
					var input, filter, table, tr, td, i, txtValue;
					input = document.querySelector('[data-kt-metrics-table-filter="search"]');
					
					filter = input.value.toUpperCase();
					console.log(filter);
					table = document.getElementById("kt_metrics_table");
					tr = table.getElementsByTagName("tr");

					// Loop through all table rows, and hide those who don't match the search query
					for (i = 0; i < tr.length; i++) {
						td_name = tr[i].getElementsByTagName("td")[1];
						td_desc = tr[i].getElementsByTagName("td")[3];
						if (td_name && td_desc) {
							nameValue = td_name.textContent || td_name.innerText;
							descValue = td_desc.textContent || td_desc.innerText;
							if (nameValue.toUpperCase().indexOf(filter) > -1 || descValue.toUpperCase().indexOf(filter) > -1) {
								tr[i].style.display = "";
							} else {
								tr[i].style.display = "none";
							}
						} 
					}

                });
            }
			handleSearchDatatable();
		});

		


		
		var metricIdToDeactivate = -1;
		function confirmDeactivateMetric(id){
			metricIdToDeactivate = id;
			$("#modalConfirmDeactivate").modal("show");
		}

		function deactivateMetric(){
			var serviceUrl = "/Metric/Deactivate/" + metricIdToDeactivate;
			$.ajax({
                url: serviceUrl,
                type: "get",
                contentType: "application/json",
                success: function (response) {
                    if (response.success) {
                       $("#metricListContainer").html(response.html);
					   KTMenu.createInstances();
					   $("#modalConfirmDeactivate").modal("hide");
                    } else {
                        console.log(serviceUrl + " did not succeed");
                    }
                    //hideBusySpinner();
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log(serviceUrl + " failed");
                    //hideBusySpinner();
                }
            });
		}


		var metricIdToDelete = -1;
		function confirmDeleteMetric(id){
			metricIdToDelete = id;
			$("#modalConfirmDelete").modal("show");
		}

		function deleteMetric(){
			var serviceUrl = "/Metric/Delete/" + metricIdToDelete;
			$.ajax({
                url: serviceUrl,
                type: "get",
                contentType: "application/json",
                success: function (response) {
                    if (response.success) {
                       $("#metricListContainer").html(response.html);
					   KTMenu.createInstances();
					   $("#modalConfirmDelete").modal("hide");
                    } else {
                        console.log(serviceUrl + " did not succeed");
                    }
                    //hideBusySpinner();
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log(serviceUrl + " failed");
                    //hideBusySpinner();
                }
            });
		}

		function activateMetric(metricId){
			var serviceUrl = "/Metric/Activate/" + metricId;
			$.ajax({
                url: serviceUrl,
                type: "get",
                contentType: "application/json",
                success: function (response) {
                    if (response.success) {
                       $("#metricListContainer").html(response.html);
					   KTMenu.createInstances();
                    } else {
                        console.log(serviceUrl + " did not succeed");
                    }
                    //hideBusySpinner();
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log(serviceUrl + " failed");
                    //hideBusySpinner();
                }
            });
		}

	</script>
	


}






